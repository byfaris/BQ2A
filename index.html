<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>الضمان الرقمي | المسح الذكي</title>
    <style>
        :root { --bg: #050505; --accent: #00ff88; --glass: rgba(255,255,255,0.05); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; height: 100vh; }

        /* واجهة الكاميرا المخفية */
        #camera-layer {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: none; flex-direction: column;
        }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* إطار الفحص الذكي */
        .scan-overlay {
            position: absolute; inset: 0; z-index: 101;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.4);
        }
        .scan-bracket {
            width: 280px; height: 180px; border: 2px solid rgba(255,255,255,0.2);
            border-radius: 20px; position: relative;
        }
        .scan-bracket::after {
            content: ''; position: absolute; inset: -2px; border: 2px solid var(--accent);
            border-radius: 20px; clip-path: inset(0 75% 75% 0); /* زاوية نيون */
        }
        .laser-line {
            position: absolute; width: 100%; height: 2px; background: var(--accent);
            box-shadow: 0 0 15px var(--accent); top: 0; animation: scanMove 2s infinite ease-in-out;
        }
        @keyframes scanMove { 0%, 100% { top: 0; } 50% { top: 100%; } }

        /* واجهة التحكم */
        .main-ui { padding: 40px 30px; display: flex; flex-direction: column; align-items: center; }
        .card { background: #111; border: 1px solid #222; border-radius: 24px; padding: 30px; width: 100%; box-sizing: border-box; }
        .btn-start { 
            position: fixed; bottom: 40px; width: 85%; padding: 20px; 
            background: #fff; color: #000; border: none; border-radius: 18px; 
            font-weight: 700; cursor: pointer;
        }

        .close-btn { position: absolute; top: 50px; right: 30px; color: #fff; font-size: 14px; z-index: 105; cursor: pointer; }
    </style>
</head>
<body>

    <div class="main-ui">
        <h1 style="font-weight: 200; letter-spacing: 2px;">الضمان الرقمي</h1>
        <div class="card" id="main-card">
            <p style="opacity: 0.5; font-size: 12px;">لا توجد ضمانات نشطة حالياً</p>
            <p style="font-size: 14px;">ابدأ بتوثيق أول أصل لك لحمايته عالمياً.</p>
        </div>
        <button class="btn-start" onclick="openCamera()">توثيق أصل جديد +</button>
    </div>

    <div id="camera-layer">
        <div class="close-btn" onclick="closeCamera()">إغلاق [X]</div>
        <div class="scan-overlay">
            <div class="scan-bracket">
                <div class="laser-line"></div>
            </div>
            <p style="margin-top: 30px; font-size: 12px; letter-spacing: 1px;">جاري التعرف على الرقم التسلسلي...</p>
        </div>
        <video id="video" autoplay playsinline></video>
    </div>

    <script>
        let stream = null;

        async function openCamera() {
            const cameraLayer = document.getElementById('camera-layer');
            const video = document.getElementById('video');

            try {
                // طلب الإذن وفتح الكاميرا الخلفية بأعلى دقة
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment", focusMode: "continuous" } 
                });
                video.srcObject = stream;
                cameraLayer.style.display = 'flex';
                
                // اهتزاز بسيط عند البدء (اختياري)
                if (navigator.vibrate) navigator.vibrate(50);

            } catch (err) {
                alert("يرجى إعطاء صلاحية الكاميرا للبدء في التوثيق.");
                console.error(err);
            }
        }

        function closeCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('camera-layer').style.display = 'none';
        }

        // منع التمرير لضمان ثبات الواجهة
        document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
    </script>
</body>
</html>
