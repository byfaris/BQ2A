<style>
    /* تصميم حاوية الخريطة */
    #map-container {
        display: none;
        width: 100%;
        max-width: 900px;
        margin-top: 20px;
        animation: zoomIn 1s cubic-bezier(0.19, 1, 0.22, 1);
    }

    @keyframes zoomIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }

    /* تصميم الدول داخل الخريطة */
    .country {
        fill: #111; /* اللون الافتراضي */
        stroke: rgba(0, 242, 255, 0.2);
        stroke-width: 0.5;
        transition: all 0.8s ease;
        cursor: pointer;
    }

    .country:hover {
        stroke: var(--accent);
        stroke-width: 1.5;
        filter: drop-shadow(0 0 5px var(--accent));
    }

    /* تصنيفات الألوان بناءً على الغالبية */
    .stable { fill: rgba(0, 255, 204, 0.4); }   /* أخضر فيروزي */
    .uncertain { fill: rgba(189, 0, 255, 0.4); } /* بنفسجي */
    .volatile { fill: rgba(255, 77, 0, 0.4); }  /* برتقالي */

    .map-legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        font-size: 0.6rem;
        letter-spacing: 2px;
    }

    .legend-item { display: flex; align-items: center; gap: 8px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; }
</style>

<div id="map-view" class="dashboard">
    <div class="status" id="map-status">GLOBAL INTUITION MAP</div>
    
    <div id="map-container">
        <div id="world-map-svg-holder"></div>
    </div>

    <div class="map-legend">
        <div class="legend-item"><div class="dot" style="background: var(--pos)"></div> <span id="leg-1">STABLE</span></div>
        <div class="legend-item"><div class="dot" style="background: var(--neu)"></div> <span id="leg-2">UNCERTAIN</span></div>
        <div class="legend-item"><div class="dot" style="background: var(--neg)"></div> <span id="leg-3">VOLATILE</span></div>
    </div>
</div>

<script>
    // مصفوفة محاكاة لتوزيع الألوان على الدول (سيتم ربطها بقاعدة بيانات لاحقاً)
    const countryData = {
        "US": "stable", "SA": "stable", "CN": "volatile", 
        "GB": "uncertain", "RU": "volatile", "EG": "uncertain"
    };

    function renderWorldMap() {
        // فنياً: سنستخدم مكتبة خفيفة أو ملف SVG خارجي، ولكن هنا سنقوم بمحاكاة التلوين
        document.getElementById('map-view').style.display = 'flex';
        
        // منطق تلوين الخريطة بناءً على تصويت الأغلبية
        Object.keys(countryData).forEach(id => {
            const countryEl = document.getElementById(id);
            if(countryEl) {
                countryEl.classList.add(countryData[id]);
            }
        });
    }

    // تعديل وظيفة الإنهاء لتشغيل الخريطة
    function toDash(type) {
        document.getElementById('view-2').style.display = 'none';
        renderWorldMap();
        
        if(currentL === 'ar') {
            document.getElementById('map-status').innerText = "خريطة الحدس العالمي";
            document.getElementById('leg-1').innerText = "مستقر";
            document.getElementById('leg-2').innerText = "غير مؤكد";
            document.getElementById('leg-3').innerText = "مضطرب";
        }
    }
</script>
